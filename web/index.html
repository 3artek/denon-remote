<!DOCTYPE html>
<html>
<head>
  <title></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container">
  <h1>Denon AVR X1000 remote</h1>
  <div class="row">
    <div class="col-md-3">
      <h2>Status</h2>
      <dl class="horizontal">
        <dt>Connected</dt><dd id="data-connected">Not connected</dd>
        <dt>Power</dt><dd id="data-power">...</dd>
        <dt>Input</dt><dd id="data-input">...</dd>
        <dt>Volume</dt><dd id="data-volume">...</dd>
      </dl>
    </div>
    <div class="col-md-9">
      <h2 id="data-info-title">...</h2>
      <pre id="data-info"></pre>
    </div>
  </div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>

  var Denon = (function() {
    return {
      connect: function(host, port) {
        // connect to the device
        socket.emit('denon.connect', { host: host, port: port });
      },

      command: function(cmd, params) {
        // turn the device on
        socket.emit('denon.command', { cmd: cmd, params: params || [] });
      },

      exec: function(cmd, params) {
        // turn the device on
        socket.emit('denon.exec', { cmd: cmd, param: param || "" });
      }
    }
  })();

  var socket = io.connect('http://localhost');
  socket.on('connect', function(data) {
    Denon.connect('192.168.0.16', 23);
  });

  socket.on('denon.connected', function(data) {
    console.log('denon.connected!');
    $("#data-connected").text("Connected");
    
    // get power state and info
    Denon.command('power');
    Denon.command('input');
    Denon.command('volume');
    Denon.command('info');
  });

  socket.on('denon.response', function(data) {
    console.log('response', data);
    switch(data.cmd) {
      case 'power':
        $("#data-power").text(data.value);
        break;
      
      case 'input':
        $("#data-input").text(data.value);
        break;      
      
      case 'volume':
        $("#data-volume").text(data.value);
        break;
      
      case 'info':
        for(index in data.value) {
          // clear on new data and change title
          if(index == 0) {
            $("#data-info").empty();
            $("#data-info-title").text(data.value[index])
          }
          // just append data
          else {
            $("#data-info").append(data.value[index] +"\n");
          }
        }
    }
  });

</script>

</body>
</html>